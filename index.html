<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>USDC TERMINAL HUB - BIG SCREEN</title>
    <style>
        :root { --primary: #00ff88; --secondary: #2775ca; --gold: #ffca28; }
        body { 
            margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; 
            background: #050505 url('background.png') no-repeat center center fixed; background-size: cover; 
            font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; 
        }
        
        #game-container { 
            background: rgba(15, 15, 15, 0.8); /* 80% Transpar√™ncia */
            padding: 20px; border-radius: 28px; width: 850px; /* Largura aumentada */
            border: 1px solid rgba(0, 255, 136, 0.3); backdrop-filter: blur(15px);
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }

        #top10-ticker {
            background: rgba(0,0,0,0.6); padding: 10px; border-radius: 12px;
            margin-bottom: 15px; overflow: hidden; white-space: nowrap; border: 1px solid rgba(255,255,255,0.05);
        }
        .marquee { display: inline-block; animation: marquee 40s linear infinite; font-weight: bold; font-size: 13px; }
        @keyframes marquee { 0% { transform: translateX(50%); } 100% { transform: translateX(-100%); } }
        .coin-box { display: inline-block; margin-right: 35px; }

        #hud { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .stat-card { background: rgba(0, 0, 0, 0.7); padding: 15px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }

        /* Tela do Jogo aumentada em 50% */
        canvas { background: rgba(0,0,0,0.95); border: 2px solid var(--secondary); border-radius: 18px; cursor: crosshair; display: block; margin: 0 auto; }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        button { border: none; padding: 16px; font-weight: bold; border-radius: 12px; cursor: pointer; text-transform: uppercase; transition: 0.3s; font-size: 14px; }
        #connect-btn { background: var(--primary); color: #000; grid-column: span 2; box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); }
        #withdraw-btn { background: var(--gold); color: #000; }
        #reset-btn { background: var(--secondary); color: #fff; }

        .locked { opacity: 0.15; pointer-events: none; filter: blur(15px); }
        #status-msg { font-size: 12px; color: var(--primary); text-align: center; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="top10-ticker">
        <div class="marquee" id="marquee-content">SINCRONIZANDO COM A BLOCKCHAIN...</div>
    </div>

    <div id="status-msg">‚ö†Ô∏è CONECTE SUA CARTEIRA PARA LIBERAR O TERMINAL</div>

    <div id="hud">
        <div class="stat-card">
            <span style="font-size: 11px; opacity: 0.7;">SALDO ACUMULADO</span>
            <div style="font-size: 24px; font-weight: bold; color: var(--primary);">$ <span id="usdc-balance">0.000</span></div>
            <div id="calc-brl" style="font-size: 12px; color: var(--gold);">R$ 0,00</div>
        </div>
        <div class="stat-card">
            <span style="font-size: 11px; opacity: 0.7;">ENERGIA DISPON√çVEL</span>
            <div id="energy-display" style="font-size: 24px; font-weight: bold;">-- / 3</div>
            <div id="energy-timer" style="font-size: 11px; color: var(--gold);">REGEN: 3H</div>
        </div>
    </div>

    <div id="canvas-wrapper" class="locked">
        <canvas id="gameCanvas" width="800" height="500"></canvas>
    </div>

    <div class="controls">
        <button id="connect-btn">üîå CONECTAR CARTEIRA METAMASK</button>
        <button id="withdraw-btn">üí∞ SACAR USDC</button>
        <button id="reset-btn">üéÆ PR√ìXIMA FASE (-1‚ö°)</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let wallet = null;
    let sessionBalance = 0; 
    let energy = { count: 3, lastUsed: Date.now() };
    const REGEN_TIME = 3 * 60 * 60 * 1000; 
    let brlRate = 5.00;

    // --- CONEX√ÉO SEGURA E DIRETA ---
    const connectBtn = document.getElementById('connect-btn');
    connectBtn.onclick = async () => {
        if (typeof window.ethereum !== 'undefined') {
            try {
                const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
                wallet = accs[0];
                
                const saved = JSON.parse(localStorage.getItem('terminal_v2_' + wallet));
                if (saved) { energy = saved.energy; sessionBalance = saved.balance || 0; }
                
                document.getElementById('usdc-balance').innerText = sessionBalance.toFixed(3);
                document.getElementById('status-msg').innerText = "‚úÖ CONECTADO: " + wallet.substring(0,12) + "...";
                connectBtn.style.display = 'none';
                document.getElementById('canvas-wrapper').classList.remove('locked');
                
                fetchPrices();
                setInterval(fetchPrices, 60000);
                startRegen();
            } catch (err) { alert("Conex√£o recusada."); }
        } else { alert("MetaMask n√£o encontrada!"); }
    };

    async function fetchPrices()