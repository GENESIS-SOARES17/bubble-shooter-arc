<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bubble Shooter Web3 ARC PRO</title>
<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:url("background.png") no-repeat center center fixed;
  background-size:cover;
  color:#fff;
}

/* LAYOUT PRINCIPAL */
#layout{
  display:flex;
  justify-content:center;
  align-items:flex-start;
  gap:12px;
  width:100%;
  height:100vh;
  padding:4vh 3vw;
}

/* PAINEL LATERAL */
#sidePanel{
  width:300px;
  background:rgba(0,0,0,0.85);
  backdrop-filter:blur(6px);
  border:1px solid rgba(0,255,170,0.5);
  border-radius:14px;
  padding:12px;
  font-size:13px;
}

h2{
  margin:2px 0 8px;
  text-align:center;
  font-size:15px;
  color:#00ffaa;
}

.row{
  display:flex;
  justify-content:space-between;
  margin:3px 0;
}

button{
  width:100%;
  margin:4px 0;
  padding:7px;
  border:none;
  border-radius:7px;
  background:linear-gradient(90deg,#00ffaa,#00aaff);
  color:#000;
  font-weight:bold;
  cursor:pointer;
}

/* CALCULADORA */
#calc{
  margin-top:8px;
  padding:8px;
  background:rgba(255,255,255,0.05);
  border-radius:8px;
}
#calc input,#calc select{
  width:100%;
  margin:3px 0;
  padding:6px;
  border-radius:6px;
  border:none;
}

/* √ÅREA DO JOGO */
#gameContainer{
  width:70vw;
  height:70vh;
  position:relative;
  border:1px solid rgba(0,255,170,0.5);
  border-radius:16px;
  overflow:hidden;
  background:rgba(0,0,0,0.1);
}

/* TRANSPAR√äNCIA 90% */
#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.9);
  pointer-events:none;
  z-index:0;
}

/* BLOQUEIO SEM CARTEIRA */
#lockScreen{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-size:20px;
  font-weight:bold;
  color:#00ffaa;
  z-index:10;
}

/* CANVAS */
canvas{
  width:100%;
  height:100%;
  display:block;
  background:transparent;
  position:relative;
  z-index:1;
}

/* BARRA DE FOR√áA */
.bar{
  width:100%;
  height:10px;
  background:rgba(255,255,255,0.1);
  border-radius:6px;
  overflow:hidden;
}
#powerBar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00ff88,#ffff00,#ff0000);
}

/* TICKER */
#ticker{
  position:absolute;
  bottom:0;
  left:0;
  width:100%;
  background:rgba(0,0,0,0.85);
  border-top:1px solid rgba(0,255,170,0.4);
  padding:4px;
  font-size:11px;
  white-space:nowrap;
  overflow:hidden;
  z-index:4;
}
#ticker span{
  margin-right:12px;
  color:#00ffaa;
}
</style>
</head>
<body>

<div id="layout">

  <!-- PAINEL LATERAL -->
  <div id="sidePanel">
    <h2>üéÆ Bubble Shooter Web3</h2>
    <div class="row">üëõ Wallet: <span id="wallet">---</span></div>
    <div class="row">üí∞ USDC: <span id="balance">0.000</span></div>
    <div class="row">‚≠ê Score: <span id="score">0</span></div>
    <div class="row">üî• Combo: <span id="combo">0</span></div>
    <div class="row">üéØ Level: <span id="level">1</span></div>

    <div>‚ö° For√ßa do tiro</div>
    <div class="bar"><div id="powerBar"></div></div>

    <button onclick="connectWallet()">Conectar MetaMask</button>
    <button onclick="deposit()">Depositar (simulado)</button>
    <button onclick="withdraw()">Sacar (simulado)</button>

    <div id="calc">
      <b>üí± Calculadora Cripto</b>
      <input type="number" id="amount" placeholder="Valor">
      <select id="asset"></select>
      <div id="result">Resultado: -</div>
    </div>
  </div>

  <!-- JOGO -->
  <div id="gameContainer">
    <div id="overlay"></div>
    <div id="lockScreen">üîí Conecte sua carteira para jogar</div>
    <canvas id="game"></canvas>
    <div id="ticker"></div>
  </div>

</div>

<script>
/* ===========================
   CANVAS
=========================== */
const container=document.getElementById("gameContainer");
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d",{alpha:true});

function resize(){
  canvas.width=container.clientWidth;
  canvas.height=container.clientHeight;
}
window.addEventListener("resize",resize);
resize();

/* ===========================
   STATE
=========================== */
const State={
  score:0,
  combo:0,
  level:1,
  balance:0,
  wallet:null,
  unlocked:false
};

function updateUI(){
  score.textContent=State.score;
  combo.textContent=State.combo;
  level.textContent=State.level;
  balance.textContent=State.balance.toFixed(3);
  wallet.textContent=State.wallet?State.wallet.slice(0,6)+"..."+State.wallet.slice(-4):"---";
}

/* ===========================
   SOM
=========================== */
const explosionSound=new Audio("explosion.mp3");
function playExplosion(){
  try{
    explosionSound.currentTime=0;
    explosionSound.play();
  }catch(e){}
}

/* ===========================
   METAMASK ARC TESTNET
=========================== */
const ARC_CHAIN_ID="0x4CF7D2"; // 5042002
async function connectWallet(){
  if(!window.ethereum){
    alert("MetaMask n√£o encontrada");
    return;
  }
  try{
    const accounts=await ethereum.request({method:"eth_requestAccounts"});
    State.wallet=accounts[0];

    await ethereum.request({
      method:"wallet_switchEthereumChain",
      params:[{chainId:ARC_CHAIN_ID}]
    });

    State.unlocked=true;
    document.getElementById("lockScreen").style.display="none";

    ethereum.on("accountsChanged",(acc)=>{
      if(acc.length===0){
        State.wallet=null;
        State.unlocked=false;
        document.getElementById("lockScreen").style.display="flex";
      }else{
        State.wallet=acc[0];
      }
      updateUI();
    });

    updateUI();
  }catch(e){
    console.log(e);
  }
}

/* ===========================
   DEP√ìSITO / SAQUE SIMULADO
=========================== */
function deposit(){
  if(!State.unlocked) return alert("Conecte a carteira primeiro!");
  State.balance+=0.01;
}
function withdraw(){
  if(!State.unlocked) return alert("Conecte a carteira primeiro!");
  if(State.balance<0.01)return alert("Saldo insuficiente");
  State.balance-=0.01;
}

/* ===========================
   PART√çCULAS
=========================== */
const particles=[];
function explode(x,y,color){
  for(let i=0;i<25;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-0.5)*6,
      life:35,
      color
    });
  }
}
function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    ctx.globalAlpha=p.life/35;
    ctx.fillStyle=p.color;
    ctx.fillRect(p.x,p.y,3,3);
    if(p.life<=0)particles.splice(i,1);
  }
  ctx.globalAlpha=1;
}

/* ===========================
   GAME ENGINE (BLOQUEADO SEM WALLET)
=========================== */
const Game={
  bubbles:[],
  bullet:{x:0,y:0,r:18,dx:0,dy:0,active:false},
  charging:false,
  power:0,
  maxPower:18,
  mouse:{x:0,y:0},

  init(){
    this.bubbles=[];
    const colors=["#00ff88","#00aaff","#ffaa00","#ff4444"];
    const gapX=45;
    const gapY=42;
    const cols=Math.floor(canvas.width/gapX);
    const rows=Math.floor(canvas.height*0.6/gapY);

    for(let i=0;i<rows;i++){
      for(let j=0;j<cols;j++){
        this.bubbles.push({
          x:gapX/2+j*gapX,
          y:gapY/2+i*gapY,
          r:16,
          color:colors[(i+j)%colors.length],
          active:true
        });
      }
    }
    this.resetBullet();
  },

  resetBullet(){
    this.bullet.x=canvas.width/2;
    this.bullet.y=canvas.height-40;
    this.bullet.active=false;
  },

  shoot(angle){
    if(this.bullet.active || !State.unlocked)return;
    const speed=4+this.power;
    this.bullet.dx=Math.cos(angle)*speed;
    this.bullet.dy=Math.sin(angle)*speed;
    this.bullet.active=true;
    this.power=0;
    powerBar.style.width="0%";
  },

  update(){
    if(!State.unlocked) return;

    if(this.charging){
      this.power=Math.min(this.maxPower,this.power+0.25);
      powerBar.style.width=(this.power/this.maxPower*100)+"%";
    }

    if(this.bullet.active){
      this.bullet.x+=this.bullet.dx;
      this.bullet.y+=this.bullet.dy;

      if(this.bullet.x<0||this.bullet.x>canvas.width) this.bullet.dx*=-1;
      if(this.bullet.y<0){
        this.resetBullet();
        State.combo=0;
      }

      for(const b of this.bubbles){
        if(!b.active)continue;
        const d=Math.hypot(this.bullet.x-b.x,this.bullet.y-b.y);
        if(d<this.bullet.r+b.r){
          b.active=false;
          playExplosion();
          explode(b.x,b.y,b.color);

          State.combo++;
          State.score+=10*State.combo;
          State.balance+=0.001;

          this.resetBullet();
        }
      }
    }

    if(this.bubbles.filter(b=>b.active).length<5){
      State.level++;
      this.init();
    }
  },

  draw(){
    ctx.fillStyle="rgba(0,0,0,0.15)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    for(const b of this.bubbles){
      if(!b.active)continue;
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
      ctx.fillStyle=b.color;
      ctx.shadowBlur=10;
      ctx.shadowColor=b.color;
      ctx.fill();
      ctx.shadowBlur=0;
    }

    ctx.beginPath();
    ctx.arc(this.bullet.x,this.bullet.y,this.bullet.r,0,Math.PI*2);
    ctx.fillStyle="#fff";
    ctx.fill();

    drawParticles();
  }
};

/* INPUT */
canvas.addEventListener("mousemove",e=>{
  const rect=canvas.getBoundingClientRect();
  Game.mouse.x=e.clientX-rect.left;
  Game.mouse.y=e.clientY-rect.top;
});
canvas.addEventListener("mousedown",()=>Game.charging=true);
canvas.addEventListener("mouseup",()=>{
  Game.charging=false;
  const angle=Math.atan2(Game.mouse.y-Game.bullet.y,Game.mouse.x-Game.bullet.x);
  Game.shoot(angle);
});

/* LOOP */
function loop(){
  Game.update();
  Game.draw();
  updateUI();
  requestAnimationFrame(loop);
}
Game.init();
loop();

/* ===========================
   CRIPTO TOP 10 + CALCULADORA
=========================== */
const assets=[
  "bitcoin","ethereum","tether","usd-coin","bnb",
  "xrp","cardano","solana","tron","dogecoin"
];

async function loadPrices(){
  try{
    const res=await fetch("https://api.coingecko.com/api/v3/simple/price?ids="+assets.join(",")+"&vs_currencies=usd");
    const data=await res.json();
    ticker.innerHTML="";
    asset.innerHTML="";
    assets.forEach(id=>{
      const price=data[id].usd;
      ticker.innerHTML+=`<span>${id.toUpperCase()}: $${price}</span>`;
      asset.innerHTML+=`<option value="${price}">${id.toUpperCase()}</option>`;
    });
  }catch(e){}
}
loadPrices();
setInterval(loadPrices,10000);

amount.oninput=calc;
asset.onchange=calc;
function calc(){
  const v=parseFloat(amount.value||0);
  const p=parseFloat(asset.value||0);
  result.textContent="Resultado: $"+(v*p).toFixed(4);
}
</script>
</body>
</html>
