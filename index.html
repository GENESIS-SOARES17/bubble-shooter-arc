<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>USDC TERMINAL - 80% TRANSPARENCY & SOUND</title>
    <style>
        :root { --primary: #00ff88; --secondary: #2775ca; --gold: #ffca28; }
        
        body { 
            margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; 
            /* Uso do background.png da sua pasta */
            background: #050505 url('background.png') no-repeat center center fixed; 
            background-size: cover; 
            font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; 
        }
        
        #game-container { 
            /* 80% de Transpar√™ncia aplicada com Blur para efeito Glassmorphism */
            background: rgba(15, 15, 15, 0.8); 
            padding: 20px; border-radius: 28px; width: 850px; 
            border: 1px solid rgba(0, 255, 136, 0.3); 
            backdrop-filter: blur(15px);
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            position: relative;
        }

        /* Ticker Top 10 */
        #ticker-top {
            background: rgba(0,0,0,0.7); padding: 10px; border-radius: 12px;
            margin-bottom: 20px; border: 1px solid #333; overflow: hidden;
        }
        .marquee-content { display: inline-block; animation: scroll 35s linear infinite; color: var(--primary); font-weight: bold; font-size: 14px; white-space: nowrap; }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .hud-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .info-card { background: rgba(0,0,0,0.6); padding: 15px; border-radius: 18px; border: 1px solid #444; text-align: center; }

        /* Jogo 50% Maior */
        canvas { background: rgba(0,0,0,0.9); border: 2px solid var(--secondary); border-radius: 20px; cursor: crosshair; display: block; margin: 0 auto; }

        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        button { border: none; padding: 16px; font-weight: bold; border-radius: 12px; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        
        #connect-btn { background: var(--primary); color: #000; grid-column: span 2; font-size: 18px; box-shadow: 0 0 20px rgba(0, 255, 136, 0.4); }
        #withdraw-btn { background: var(--gold); color: #000; }
        #reset-btn { background: var(--secondary); color: #fff; }

        .locked { opacity: 0.1; pointer-events: none; filter: blur(20px); }
        .coin-span { margin-right: 45px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ticker-top">
        <div class="marquee-content" id="price-marquee">SINCRONIZANDO COM O MERCADO GLOBAL...</div>
    </div>

    <div class="hud-row">
        <div class="info-card">
            <span style="font-size: 11px; opacity: 0.6;">SALDO ACUMULADO</span>
            <div style="font-size: 26px; font-weight: bold; color: var(--primary);">$ <span id="usdc-val">0.000</span></div>
            <div id="brl-val" style="color: var(--gold); font-size: 13px; font-weight: bold;">R$ 0,00</div>
        </div>
        <div class="info-card">
            <span style="font-size: 11px; opacity: 0.6;">ENERGIA DISPON√çVEL</span>
            <div id="energy-val" style="font-size: 26px; font-weight: bold;">-- / 3</div>
            <div style="font-size: 11px; color: var(--gold);">REGEN: 3 HORAS</div>
        </div>
    </div>

    <div id="canvas-wrapper" class="locked">
        <canvas id="gameCanvas" width="800" height="450"></canvas>
    </div>

    <div class="btn-row">
        <button id="connect-btn">üîå CONECTAR CARTEIRA AGORA</button>
        <button id="withdraw-btn">üí∞ SACAR USDC</button>
        <button id="reset-btn">üöÄ JOGAR FASE (-1‚ö°)</button>
    </div>
</div>

<script>
    // --- L√ìGICA DE √ÅUDIO ---
    const soundExplosion = new Audio('explosion.mp3'); 
    soundExplosion.volume = 0.4;

    function playExplosion() {
        soundExplosion.currentTime = 0; 
        soundExplosion.play().catch(() => {}); 
    }

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let wallet = null;
    let balance = 0; 
    let energy = { count: 3, lastUsed: Date.now() };
    let brlPrice = 5.60;

    // --- CONEX√ÉO WEB3 ---
    document.getElementById('connect-btn').onclick = async () => {
        if (window.ethereum) {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                wallet = accounts[0];
                
                // Ativa √°udio ap√≥s intera√ß√£o do usu√°rio
                soundExplosion.play().then(() => { soundExplosion.pause(); });

                document.getElementById('connect-btn').style.display = 'none';
                document.getElementById('canvas-wrapper').classList.remove('locked');
                
                fetchMarketData();
                setInterval(fetchMarketData, 60000);
                startEnergySystem();
            } catch (e) { alert("Conex√£o cancelada."); }
        } else { alert("MetaMask n√£o detectada!"); }
    };

    async function fetchMarketData() {
        try {
            // Top 10 Ranking
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10');
            const data = await res.json();
            document.getElementById('price-marquee').innerHTML = data.map(c => `
                <span class="coin-span">${c.symbol.toUpperCase()}: $${c.current_price.toLocaleString()}</span>
            `).join('');

            // Convers√£o BRL
            const brlRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=usd-coin&vs_currencies=brl');
            const brlData = await brlRes.json();
            brlPrice = brlData['usd-coin'].brl;
            updateUI();
        } catch (e) { console.log("Erro ao carregar pre√ßos."); }
    }

    function updateUI() {
        document.getElementById('usdc-val').innerText = balance.toFixed(3);
        document.getElementById('brl-val').innerText = `R$ ${(balance * brlPrice).toFixed(2)}`;
        document.getElementById('energy-val').innerText = `${energy.count} / 3`;
    }

    function startEnergySystem() {
        setInterval(updateUI, 1000);
    }

    // --- ENGINE DO JOGO ---
    let bubbles = [], bullet = { x: 400, y: 420, r: 16, active: false, dx: 0, dy: 0 };

    function initGame() {
        bubbles = [];
        const colors = ['#00ff88', '#2775ca', '#ffca28', '#ff4444'];
        for (let i = 0; i < 5; i++) {
            for (let j = 0; j < 18; j++) {
                bubbles.push({ x: 40+(j*43), y: 55+(i*43), r: 18, color: colors[i % 4], active: true });
            }
        }
    }

    document.getElementById('reset-btn').onclick = () => {
        if (energy.count > 0) {
            energy.count--; initGame();
        } else alert("Aguarde a regenera√ß√£o de energia.");
    };

    canvas.addEventListener('mousedown', (e) => {
        if (bullet.active || !wallet) return;
        const rect = canvas.getBoundingClientRect();
        const angle = Math.atan2((e.clientY - rect.top) - bullet.y, (e.clientX - rect.left) - bullet.x);
        bullet.dx = Math.cos(angle) * 12; bullet.dy = Math.sin(angle) * 12;
        bullet.active = true;
    });

    function update() {
        if (bullet.active) {
            bullet.x += bullet.dx; bullet.y += bullet.dy;
            if (bullet.x < 0 || bullet.x > 800) bullet.dx *= -1;
            bubbles.forEach(b => {
                if (b.active && Math.hypot(bullet.x - b.x, bullet.y - b.y) < bullet.r + b.r) {
                    b.active = false;
                    balance += 0.005;
                    bullet.active = false; bullet.x = 400; bullet.y = 420;
                    playExplosion(); 
                }
            });
            if (bullet.y < 0 || bullet.y > 450) { bullet.active = false; bullet.x = 400; bullet.y = 420; }
        }
    }

    function draw() {
        ctx.clearRect(0, 0, 800, 450);
        bubbles.forEach(b => {
            if (b.active) {
                ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
                ctx.fillStyle = b.color; ctx.fill();
            }
        });
        ctx.beginPath(); ctx.arc(bullet.x, bullet.y, bullet.r, 0, Math.PI*2);
        ctx.fillStyle = "#fff"; ctx.fill();
        update();
        requestAnimationFrame(draw);
    }

    initGame(); draw();
</script>
</body>
</html>