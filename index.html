<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bubble Shooter Web3 PRO - ARC</title>
<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#020617,#000);
  color:#fff;
  font-family:Arial, sans-serif;
  overflow:hidden;
}

/* ===== FUNDO ===== */
#bg{
  position:fixed;
  inset:0;
  background:
    linear-gradient(120deg,rgba(0,255,170,0.06),transparent 60%),
    linear-gradient(300deg,rgba(0,150,255,0.05),transparent 60%);
  z-index:-1;
}

/* ===== PAINEL CENTRAL GAMER ===== */
#panel{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:340px;
  background:rgba(0,0,0,0.9); /* 90% transpar√™ncia */
  backdrop-filter:blur(8px);
  border:1px solid rgba(0,255,170,0.5);
  border-radius:16px;
  padding:12px;
  z-index:10;
  font-size:13px;
}

h2{
  margin:4px 0 6px;
  text-align:center;
  font-size:16px;
  color:#00ffaa;
}

.row{
  display:flex;
  justify-content:space-between;
  margin:2px 0;
}

button{
  width:100%;
  margin:4px 0;
  padding:8px;
  border:none;
  border-radius:8px;
  background:linear-gradient(90deg,#00ffaa,#00aaff);
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
button:active{transform:scale(0.98)}

.bar{
  width:100%;
  height:10px;
  background:rgba(255,255,255,0.1);
  border-radius:6px;
  overflow:hidden;
}
#powerBar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00ff88,#ffff00,#ff0000);
}

/* ===== TICKER CRIPTO ===== */
#ticker{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:rgba(0,0,0,0.85);
  border-top:1px solid rgba(0,255,170,0.4);
  padding:6px;
  font-size:12px;
  white-space:nowrap;
  overflow:hidden;
}
#ticker span{
  margin-right:14px;
  color:#00ffaa;
}

/* ===== CALCULADORA ===== */
#calc{
  margin-top:6px;
  padding:6px;
  background:rgba(255,255,255,0.05);
  border-radius:10px;
}
#calc input, #calc select{
  width:100%;
  margin:2px 0;
  padding:6px;
  border-radius:6px;
  border:none;
  outline:none;
}

/* ===== CANVAS ===== */
canvas{
  display:block;
}
</style>
</head>
<body>

<div id="bg"></div>

<div id="panel">
  <h2>üéÆ Bubble Shooter Web3 PRO</h2>

  <div class="row">üëõ Wallet: <span id="wallet">---</span></div>
  <div class="row">üí∞ USDC: <span id="balance">0.000</span></div>
  <div class="row">‚≠ê Score: <span id="score">0</span></div>
  <div class="row">üî• Combo: <span id="combo">0</span></div>
  <div class="row">üéØ Level: <span id="level">1</span></div>

  <div>‚ö° For√ßa do tiro</div>
  <div class="bar"><div id="powerBar"></div></div>

  <button onclick="connectWallet()">Conectar MetaMask</button>
  <button onclick="deposit()">Depositar (simulado)</button>
  <button onclick="withdraw()">Sacar (simulado)</button>

  <!-- CALCULADORA CRIPTO -->
  <div id="calc">
    <b>üí± Calculadora Cripto</b>
    <input type="number" id="amount" placeholder="Valor">
    <select id="asset"></select>
    <div id="result">Resultado: -</div>
  </div>
</div>

<canvas id="game"></canvas>

<div id="ticker"></div>

<script>
/* ===========================
   CANVAS
=========================== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d",{alpha:true});
function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}
addEventListener("resize",resize);
resize();

/* ===========================
   STATE
=========================== */
const State={
  score:0,
  combo:0,
  level:1,
  balance:0,
  wallet:null
};

function updateUI(){
  score.textContent=State.score;
  combo.textContent=State.combo;
  level.textContent=State.level;
  balance.textContent=State.balance.toFixed(3);
  wallet.textContent=State.wallet?State.wallet.slice(0,6)+"..."+State.wallet.slice(-4):"---";
}

/* ===========================
   SOUND FX
=========================== */
const SFX={
  boom:new Audio("https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-explosion-2759.mp3"),
  shoot:new Audio("https://assets.mixkit.co/sfx/preview/mixkit-game-ball-tap-2073.mp3")
};
function playSound(name){
  try{SFX[name].currentTime=0;SFX[name].play();}catch(e){}
}

/* ===========================
   METAMASK (ARC TESTNET)
=========================== */
const ARC_CHAIN_ID="0x4CF7D2"; // 5042002 em hex
async function connectWallet(){
  if(!window.ethereum){alert("MetaMask n√£o encontrada");return;}
  const acc=await ethereum.request({method:"eth_requestAccounts"});
  State.wallet=acc[0];

  // tentar adicionar rede ARC testnet
  try{
    await ethereum.request({
      method:"wallet_switchEthereumChain",
      params:[{chainId:ARC_CHAIN_ID}]
    });
  }catch(e){}

  updateUI();
}

/* ===========================
   DEP√ìSITO / SAQUE (SIMULADO)
=========================== */
function deposit(){
  State.balance+=0.01;
  alert("Dep√≥sito simulado: +0.01 USDC");
}
function withdraw(){
  if(State.balance<0.01){alert("Saldo insuficiente");return;}
  State.balance-=0.01;
  alert("Saque simulado: -0.01 USDC");
}

/* ===========================
   PARTICLES (EXPLOS√ÉO REAL)
=========================== */
const particles=[];
function explode(x,y,color){
  for(let i=0;i<25;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*7,
      vy:(Math.random()-0.5)*7,
      life:40,
      color,
      size:2+Math.random()*3
    });
  }
}
function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    ctx.globalAlpha=p.life/40;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
    if(p.life<=0) particles.splice(i,1);
  }
  ctx.globalAlpha=1;
}

/* ===========================
   GAME ENGINE
=========================== */
const Game={
  bubbles:[],
  bullet:{x:0,y:0,r:20,dx:0,dy:0,active:false}, // shooter 25% maior
  charging:false,
  power:0,
  maxPower:20,
  mouse:{x:0,y:0},

  init(){
    this.bubbles=[];
    const colors=["#00ff88","#00aaff","#ffaa00","#ff4444","#ff00ff"];
    const gapX=50;
    const gapY=45;
    const cols=Math.floor(canvas.width/gapX);
    const rows=Math.floor(canvas.height*0.65/gapY);

    for(let i=0;i<rows;i++){
      for(let j=0;j<cols;j++){
        let type="normal";
        const rnd=Math.random();
        if(rnd<0.05) type="bomb";
        else if(rnd<0.10) type="gold";
        else if(rnd<0.15) type="multi";

        this.bubbles.push({
          x:gapX/2+j*gapX,
          y:gapY/2+i*gapY,
          r:18,
          color:colors[(i+j)%colors.length],
          active:true,
          type
        });
      }
    }
    this.resetBullet();
  },

  resetBullet(){
    this.bullet.x=canvas.width/2;
    this.bullet.y=canvas.height-60;
    this.bullet.active=false;
    this.bullet.dx=0;
    this.bullet.dy=0;
  },

  shoot(angle){
    if(this.bullet.active) return;
    playSound("shoot");
    const speed=4+this.power*1.3;
    this.bullet.dx=Math.cos(angle)*speed;
    this.bullet.dy=Math.sin(angle)*speed;
    this.bullet.active=true;
    this.power=0;
    powerBar.style.width="0%";
  },

  update(){
    if(this.charging){
      this.power=Math.min(this.maxPower,this.power+0.3);
      powerBar.style.width=(this.power/this.maxPower*100)+"%";
    }

    if(this.bullet.active){
      this.bullet.x+=this.bullet.dx;
      this.bullet.y+=this.bullet.dy;

      if(this.bullet.x<0||this.bullet.x>canvas.width) this.bullet.dx*=-1;
      if(this.bullet.y<0){
        this.resetBullet();
        State.combo=0;
      }

      for(const b of this.bubbles){
        if(!b.active) continue;
        const d=Math.hypot(this.bullet.x-b.x,this.bullet.y-b.y);
        if(d<this.bullet.r+b.r){
          b.active=false;
          playSound("boom");
          explode(b.x,b.y,b.color);

          State.combo++;
          let pts=10*State.combo;
          let reward=0.001;

          if(b.type==="gold"){pts*=3;reward*=3;}
          if(b.type==="multi"){pts*=2;reward*=2;}
          if(b.type==="bomb"){
            for(const bb of this.bubbles){
              if(Math.hypot(bb.x-b.x,bb.y-b.y)<80) bb.active=false;
            }
          }

          State.score+=pts;
          State.balance+=reward;

          this.resetBullet();
        }
      }
    }

    if(this.bubbles.filter(b=>b.active).length<5){
      State.level++;
      this.init();
    }
  },

  draw(){
    ctx.fillStyle="rgba(0,0,0,0.12)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    for(const b of this.bubbles){
      if(!b.active) continue;
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
      ctx.fillStyle=b.color;
      ctx.shadowBlur=15;
      ctx.shadowColor=b.color;
      ctx.fill();
      ctx.shadowBlur=0;

      if(b.type==="gold"){ctx.fillStyle="#fff";ctx.fillText("üíé",b.x-6,b.y+4);}
      if(b.type==="bomb"){ctx.fillStyle="#fff";ctx.fillText("üí£",b.x-6,b.y+4);}
      if(b.type==="multi"){ctx.fillStyle="#fff";ctx.fillText("‚ö°",b.x-6,b.y+4);}
    }

    ctx.beginPath();
    ctx.arc(this.bullet.x,this.bullet.y,this.bullet.r,0,Math.PI*2);
    ctx.fillStyle="#fff";
    ctx.shadowBlur=10;
    ctx.shadowColor="#fff";
    ctx.fill();
    ctx.shadowBlur=0;

    const angle=Math.atan2(Game.mouse.y-this.bullet.y,Game.mouse.x-this.bullet.x);
    ctx.strokeStyle="rgba(0,255,255,0.35)";
    ctx.beginPath();
    ctx.moveTo(this.bullet.x,this.bullet.y);
    ctx.lineTo(this.bullet.x+Math.cos(angle)*1000,this.bullet.y+Math.sin(angle)*1000);
    ctx.stroke();

    drawParticles();
  }
};

/* ===========================
   INPUT
=========================== */
canvas.addEventListener("mousemove",e=>{
  Game.mouse.x=e.clientX;
  Game.mouse.y=e.clientY;
});
canvas.addEventListener("mousedown",()=>Game.charging=true);
canvas.addEventListener("mouseup",()=>{
  Game.charging=false;
  const angle=Math.atan2(Game.mouse.y-Game.bullet.y,Game.mouse.x-Game.bullet.x);
  Game.shoot(angle);
});

/* ===========================
   LOOP
=========================== */
function loop(){
  Game.update();
  Game.draw();
  updateUI();
  requestAnimationFrame(loop);
}
Game.init();
loop();

/* ===========================
   CRYPTO PRICES (TOP 10)
=========================== */
const assets=[
  "bitcoin","ethereum","tether","usd-coin","bnb",
  "xrp","cardano","solana","tron","dogecoin"
];

async function loadPrices(){
  try{
    const url="https://api.coingecko.com/api/v3/simple/price?ids="+assets.join(",")+"&vs_currencies=usd";
    const res=await fetch(url);
    const data=await res.json();

    ticker.innerHTML="";
    asset.innerHTML="";
    assets.forEach(id=>{
      const price=data[id].usd;
      ticker.innerHTML+=`<span>${id.toUpperCase()}: $${price}</span>`;
      asset.innerHTML+=`<option value="${price}">${id.toUpperCase()}</option>`;
    });
  }catch(e){}
}
loadPrices();
setInterval(loadPrices,10000);

/* ===========================
   CALCULADORA
=========================== */
amount.addEventListener("input",calc);
asset.addEventListener("change",calc);

function calc(){
  const val=parseFloat(amount.value||0);
  const price=parseFloat(asset.value||0);
  const usd=val*price;
  result.textContent="Resultado: $"+usd.toFixed(4);
}
</script>
</body>
</html>