<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>WEB3 SHOOTER PRO</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.8.1/dist/ethers.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial;}
body{
  background:#000;
  color:#0ff;
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* ğŸ® JOGO */
#gameArea{
  width:70%;
  height:100%;
  position:relative;
  background:url("background.png") center/cover no-repeat;
}
#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.9); /* 90% transparÃªncia */
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:10px;
  z-index:10;
}
button{
  padding:10px 18px;
  background:#00ffff;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
button:disabled{
  background:#333;
  color:#777;
}
canvas{
  width:100%;
  height:100%;
  display:block;
}

/* ğŸ“Š PAINEL LATERAL */
#sidePanel{
  width:30%;
  height:100%;
  background:rgba(0,0,0,0.85);
  border-left:2px solid #00ffff;
  padding:15px;
  overflow:auto;
}
.panelBox{
  border:1px solid #00ffff;
  border-radius:10px;
  padding:10px;
  margin-bottom:12px;
}
h3{margin-bottom:8px;color:#0ff;}
input{
  width:100%;
  padding:6px;
  margin:4px 0;
  background:#000;
  color:#0ff;
  border:1px solid #0ff;
  border-radius:4px;
}
</style>
</head>
<body>

<div id="gameArea">
  <canvas id="game"></canvas>

  <div id="overlay">
    <h2>ğŸ® WEB3 SHOOTER PRO</h2>
    <button id="connectBtn">ğŸ”— Conectar Carteira</button>
    <button id="signBtn" disabled>âœï¸ Assinar Mensagem</button>
    <button id="startBtn" disabled>â–¶ï¸ Iniciar Jogo</button>
    <p id="walletInfo"></p>
  </div>
</div>

<div id="sidePanel">
  <div class="panelBox">
    <h3>ğŸ‘› Carteira</h3>
    <div id="walletStatus">Desconectada</div>
  </div>

  <div class="panelBox">
    <h3>ğŸ’ Calculadora Cripto</h3>
    <input id="usdInput" placeholder="USD">
    <input id="usdcInput" placeholder="USDC">
    <button onclick="convert()">Converter</button>
  </div>

  <div class="panelBox">
    <h3>ğŸ“Š Info do Jogo</h3>
    <div>Pontos: <span id="score">0</span></div>
    <div>NÃ­vel: <span id="level">1</span></div>
  </div>
</div>

<audio id="explosionSound" src="explosion.mp3"></audio>

<script>
/* ================== WEB3 ================== */

const ARC_CHAIN = {
  chainId: "0x4D01F2", // 5042002 hex
  chainName: "ARC Testnet",
  rpcUrls: ["https://rpc.testnet.arc.network"],
  nativeCurrency: { name:"ARC", symbol:"ARC", decimals:18 },
  blockExplorerUrls: []
};

let provider, signer, walletAddress;
let signed = false;

const connectBtn = document.getElementById("connectBtn");
const signBtn = document.getElementById("signBtn");
const startBtn = document.getElementById("startBtn");
const walletInfo = document.getElementById("walletInfo");
const walletStatus = document.getElementById("walletStatus");

connectBtn.onclick = async () => {
  if(!window.ethereum){
    alert("MetaMask nÃ£o encontrada!");
    return;
  }

  provider = new ethers.BrowserProvider(window.ethereum);

  await window.ethereum.request({ method: "eth_requestAccounts" });

  try{
    await window.ethereum.request({
      method:"wallet_switchEthereumChain",
      params:[{chainId: ARC_CHAIN.chainId}]
    });
  }catch(e){
    await window.ethereum.request({
      method:"wallet_addEthereumChain",
      params:[ARC_CHAIN]
    });
  }

  signer = await provider.getSigner();
  walletAddress = await signer.getAddress();

  walletInfo.innerText = "Carteira: " + walletAddress.slice(0,6)+"..."+walletAddress.slice(-4);
  walletStatus.innerText = "Conectada âœ…";

  signBtn.disabled = false;
};

signBtn.onclick = async () => {
  try{
    const msg = "Autorizo jogar no WEB3 SHOOTER PRO";
    await signer.signMessage(msg);
    signed = true;
    signBtn.disabled = true;
    startBtn.disabled = false;
    walletStatus.innerText = "Conectada + Assinada âœ…";
  }catch(e){
    alert("Assinatura cancelada!");
  }
};

/* ================== JOGO ================== */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
}
window.addEventListener("resize", resize);
resize();

let bubbles = [];
let bullets = [];
let score = 0;
let level = 1;
let playing = false;

function spawnBubble(){
  bubbles.push({
    x: Math.random()*canvas.width,
    y: canvas.height+20,
    r: 15 + Math.random()*20,
    speed: 1 + level*0.3
  });
}

function shoot(x,y){
  bullets.push({x,y,speed:8});
}

canvas.addEventListener("click",(e)=>{
  if(!playing) return;
  shoot(e.offsetX,e.offsetY);
});

function explosion(x,y){
  const sound = document.getElementById("explosionSound");
  sound.currentTime = 0;
  sound.play();
}

function update(){
  if(!playing) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(Math.random()<0.02) spawnBubble();

  bubbles.forEach((b,i)=>{
    b.y -= b.speed;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fillStyle="rgba(0,255,255,0.7)";
    ctx.fill();

    bullets.forEach((bu,j)=>{
      const dx=b.x-bu.x;
      const dy=b.y-bu.y;
      if(Math.sqrt(dx*dx+dy*dy)<b.r){
        explosion(b.x,b.y);
        bubbles.splice(i,1);
        bullets.splice(j,1);
        score++;
        if(score%10==0) level++;
        document.getElementById("score").innerText=score;
        document.getElementById("level").innerText=level;
      }
    });
  });

  bullets.forEach((bu,j)=>{
    bu.y -= bu.speed;
    ctx.fillStyle="#fff";
    ctx.fillRect(bu.x,bu.y,3,8);
    if(bu.y<0) bullets.splice(j,1);
  });

  requestAnimationFrame(update);
}

startBtn.onclick = ()=>{
  if(!signed){
    alert("Conecte e assine a carteira!");
    return;
  }
  document.getElementById("overlay").style.display="none";
  playing = true;
  update();
};

/* ================== CALCULADORA ================== */

function convert(){
  const usd = parseFloat(document.getElementById("usdInput").value||0);
  const usdc = parseFloat(document.getElementById("usdcInput").value||0);
  if(usd>0){
    document.getElementById("usdcInput").value = usd.toFixed(2);
  }else if(usdc>0){
    document.getElementById("usdInput").value = usdc.toFixed(2);
  }
}
</script>
</body>
</html>
