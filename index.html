<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>USDC TERMINAL & ARCADE</title>
    <style>
        :root { --primary: #00ff88; --secondary: #2775ca; --gold: #ffca28; --up: #00ff88; --down: #ff4444; }
        body { 
            margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; 
            background: #050505 url('background.png') no-repeat center center fixed; background-size: cover; 
            font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; 
        }
        
        #game-container { 
            background: rgba(15, 15, 15, 0.8); /* 80% Transparência */
            padding: 20px; border-radius: 28px; width: 600px; 
            border: 1px solid rgba(0, 255, 136, 0.3); backdrop-filter: blur(15px);
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }

        /* Ticker Top 10 Animado */
        #top10-ticker {
            background: rgba(0,0,0,0.6); padding: 8px; border-radius: 10px;
            margin-bottom: 15px; overflow: hidden; white-space: nowrap;
            border: 1px solid rgba(255,255,255,0.05); font-size: 12px;
        }
        .marquee { display: inline-block; animation: marquee 30s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .coin-box { display: inline-block; margin-right: 25px; font-weight: bold; }

        .calc-section { 
            background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px; 
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1);
        }

        #hud { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .stat-card { background: rgba(0, 0, 0, 0.6); padding: 10px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }

        canvas { background: rgba(0,0,0,0.95); border: 2px solid var(--secondary); border-radius: 18px; cursor: crosshair; }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        button { border: none; padding: 12px; font-weight: bold; border-radius: 10px; cursor: pointer; text-transform: uppercase; transition: 0.2s; }
        #connect-btn { background: var(--primary); color: #000; grid-column: span 2; }
        #withdraw-btn { background: var(--gold); }
        #reset-btn { background: var(--secondary); color: #fff; }

        .locked { opacity: 0.1; pointer-events: none; filter: blur(12px); }
    </style>
</head>
<body>

<div id="game-container">
    <div id="top10-ticker">
        <div class="marquee" id="marquee-content">CARREGANDO MARKET DATA...</div>
    </div>

    <div class="header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h3 style="margin: 0; color: var(--primary); font-size: 16px;">USDC TERMINAL PRO</h3>
        <span id="wallet-status" style="font-size: 9px; opacity: 0.5;">DISCONNECTED</span>
    </div>

    <div class="calc-section">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 14px;">Saldo: <span id="calc-usdc" style="color:var(--primary); font-weight:bold;">0.00</span> USDC</div>
            <div style="text-align: right; font-size: 14px; color: var(--gold);">
                ≈ <span id="calc-brl">R$ 0,00</span>
            </div>
        </div>
    </div>

    <div id="hud">
        <div class="stat-card">
            <span style="font-size: 9px; opacity: 0.7;">GANHOS</span>
            <div style="font-size: 16px; font-weight: bold; color: var(--primary);">$ <span id="usdc-balance">0.000</span></div>
        </div>
        <div class="stat-card">
            <span style="font-size: 9px; opacity: 0.7;">ENERGIA</span>
            <div id="energy-display" style="font-size: 16px; font-weight: bold;">-- / 3</div>
        </div>
    </div>

    <div id="canvas-wrapper" class="locked">
        <canvas id="gameCanvas" width="560" height="300"></canvas>
    </div>

    <div class="controls">
        <button id="connect-btn">CONECTAR CARTEIRA</button>
        <button id="withdraw-btn">SACAR</button>
        <button id="reset-btn">JOGAR (-1⚡)</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let wallet = null;
    let sessionBalance = 0; 
    let energy = { count: 3, lastUsed: Date.now() };
    const REGEN_TIME = 3 * 60 * 60 * 1000; 
    let usdInBrl = 5.00;

    // --- BUSCA TOP 10 MOEDAS ---
    async function fetchTop10() {
        try {
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&sparkline=false&price_change_percentage=24h');
            const data = await res.json();
            
            const marquee = document.getElementById('marquee-content');
            marquee.innerHTML = ''; // Limpa

            data.forEach(coin => {
                const change = coin.price_change_percentage_24h;
                const colorClass = change >= 0 ? '#00ff88' : '#ff4444';
                const sign = change >= 0 ? '+' : '';
                
                marquee.innerHTML += `
                    <span class="coin-box">
                        ${coin.symbol.toUpperCase()}: $${coin.current_price.toLocaleString()} 
                        <span style="color: ${colorClass}; font-size: 10px;">${sign}${change.toFixed(2)}%</span>
                    </span>
                `;
                if(coin.id === 'usd-coin') usdInBrl = coin.current_price; // Simulação para cálculo
            });

            // Fallback para BRL caso não venha no Top 10
            const brlRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=usd-coin&vs_currencies=brl');
            const brlData = await brlRes.json();
            usdInBrl = brlData['usd-coin'].brl;
            
            updateCalculations();
        } catch (e) { console.log("Erro API"); }
    }

    function updateCalculations() {
        document.getElementById('calc-usdc').innerText = sessionBalance.toFixed(3);
        document.getElementById('calc-brl').innerText = `R$ ${(sessionBalance * usdInBrl).toFixed(2)}`;
    }

    // --- WEB3 ---
    document.getElementById('connect-btn').onclick = async () => {
        if (window.ethereum) {
            const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
            wallet = accs[0];
            const saved = JSON.parse(localStorage.getItem('terminal_' + wallet));
            if (saved) { energy = saved.energy; sessionBalance = saved.balance || 0; }
            
            document.getElementById('usdc-balance').innerText = sessionBalance.toFixed(3);
            document.getElementById('wallet-status').innerText = "ONLINE: " + wallet.substring(0,6);
            document.getElementById('connect-btn').style.display = 'none';
            document.getElementById('canvas-wrapper').classList.remove('locked');
            
            fetchTop10();
            setInterval(fetchTop10, 60000);
            startEnergyLoop();
        }
    };

    function startEnergyLoop() {
        setInterval(() => {
            const now = Date.now();
            const elapsed = now - energy.lastUsed;
            if (Math.floor(elapsed / REGEN_TIME) > 0 && energy.count < 3) {
                energy.count++; energy.lastUsed = now;
            }
            document.getElementById('energy-display').innerText = `${energy.count} / 3`;
            updateCalculations();
        }, 1000);
    }

    // --- JOGO ---
    const colors = ['#00BFFF', '#FF1493', '#