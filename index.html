<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bubble Shooter Web3 ARC</title>
<style>
body{
  margin:0;
  background:radial-gradient(circle,#020617,#000);
  color:#fff;
  font-family:Arial;
  overflow:hidden;
}
canvas{display:block;}
.panel{
  position:fixed;
  top:10px;
  left:10px;
  background:rgba(0,0,0,0.55);
  backdrop-filter:blur(6px);
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(0,255,170,0.4);
  font-size:13px;
  z-index:10;
  width:260px;
}
button{
  width:100%;
  margin:4px 0;
  padding:7px;
  border:none;
  border-radius:6px;
  background:#00ffaa;
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
.bar{
  width:100%;
  height:10px;
  background:rgba(255,255,255,0.1);
  border-radius:6px;
  overflow:hidden;
  margin-top:4px;
}
#powerBar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00ff88,#ffff00,#ff0000);
}
</style>
</head>
<body>

<div class="panel">
  <div>üëõ Wallet: <span id="wallet">---</span></div>
  <div>üí∞ USDC: <span id="balance">0</span></div>
  <div>‚≠ê Score: <span id="score">0</span></div>
  <div>üî• Combo: <span id="combo">0</span></div>
  <div>üéØ Level: <span id="level">1</span></div>
  <div>‚ö° Power</div>
  <div class="bar"><div id="powerBar"></div></div>
  <button onclick="connectWallet()">Conectar MetaMask</button>
</div>

<canvas id="game"></canvas>

<script>
/* ===========================
   CANVAS
=========================== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d",{alpha:true});

function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
}
addEventListener("resize",resize);
resize();

/* ===========================
   STATE
=========================== */
const State={
  score:0,
  combo:0,
  level:1,
  balance:0,
  wallet:null
};

function updateUI(){
  score.textContent=State.score;
  combo.textContent=State.combo;
  level.textContent=State.level;
  balance.textContent=State.balance.toFixed(3);
  wallet.textContent=State.wallet?State.wallet.slice(0,6)+"..."+State.wallet.slice(-4):"---";
}

/* ===========================
   METAMASK (SIMPLES E EST√ÅVEL)
=========================== */
async function connectWallet(){
  if(!window.ethereum){
    alert("MetaMask n√£o encontrada");
    return;
  }
  const acc=await ethereum.request({method:"eth_requestAccounts"});
  State.wallet=acc[0];
  updateUI();
}

/* ===========================
   PARTICLES (EXPLOS√ÉO REAL)
=========================== */
const particles=[];
function explode(x,y,color){
  for(let i=0;i<30;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-0.5)*6,
      life:40,
      color,
      size:2+Math.random()*3
    });
  }
}

function drawParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    ctx.globalAlpha=p.life/40;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
    if(p.life<=0) particles.splice(i,1);
  }
  ctx.globalAlpha=1;
}

/* ===========================
   GAME ENGINE
=========================== */
const Game={
  bubbles:[],
  bullet:{x:0,y:0,r:19,dx:0,dy:0,active:false},
  charging:false,
  power:0,
  maxPower:18,
  mouse:{x:0,y:0},

  init(){
    this.bubbles=[];
    const colors=["#00ff88","#00aaff","#ffaa00","#ff4444"];
    const gapX=48;
    const gapY=44;
    const cols=Math.floor(canvas.width/gapX);
    const rows=Math.floor(canvas.height*0.65/gapY);

    for(let i=0;i<rows;i++){
      for(let j=0;j<cols;j++){
        this.bubbles.push({
          x:gapX/2+j*gapX,
          y:gapY/2+i*gapY,
          r:18,
          color:colors[(i+j)%colors.length],
          active:true
        });
      }
    }
    this.resetBullet();
  },

  resetBullet(){
    this.bullet.x=canvas.width/2;
    this.bullet.y=canvas.height-60;
    this.bullet.active=false;
    this.bullet.dx=0;
    this.bullet.dy=0;
  },

  shoot(angle){
    if(this.bullet.active) return;
    const speed=4+this.power*1.2;
    this.bullet.dx=Math.cos(angle)*speed;
    this.bullet.dy=Math.sin(angle)*speed;
    this.bullet.active=true;
    this.power=0;
    powerBar.style.width="0%";
  },

  update(){
    // carregar tiro
    if(this.charging){
      this.power=Math.min(this.maxPower,this.power+0.25);
      powerBar.style.width=(this.power/this.maxPower*100)+"%";
    }

    // mover bala
    if(this.bullet.active){
      this.bullet.x+=this.bullet.dx;
      this.bullet.y+=this.bullet.dy;

      // ricochete lateral
      if(this.bullet.x<0 || this.bullet.x>canvas.width){
        this.bullet.dx*=-1;
      }

      // sair do topo
      if(this.bullet.y<0){
        this.resetBullet();
        State.combo=0;
      }

      // colis√£o com bolhas
      for(const b of this.bubbles){
        if(!b.active) continue;
        const d=Math.hypot(this.bullet.x-b.x,this.bullet.y-b.y);
        if(d<this.bullet.r+b.r){
          b.active=false;
          explode(b.x,b.y,b.color);

          State.combo++;
          State.score+=10*State.combo;
          State.balance+=0.001;

          this.resetBullet();
        }
      }
    }

    // pr√≥ximo n√≠vel
    if(this.bubbles.filter(b=>b.active).length<6){
      State.level++;
      this.init();
    }
  },

  draw(){
    // fundo transparente + fade leve
    ctx.fillStyle="rgba(0,0,0,0.15)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // bolhas
    for(const b of this.bubbles){
      if(!b.active) continue;
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
      ctx.fillStyle=b.color;
      ctx.shadowBlur=15;
      ctx.shadowColor=b.color;
      ctx.fill();
      ctx.shadowBlur=0;
    }

    // bala
    ctx.beginPath();
    ctx.arc(this.bullet.x,this.bullet.y,this.bullet.r,0,Math.PI*2);
    ctx.fillStyle="#fff";
    ctx.shadowBlur=10;
    ctx.shadowColor="#fff";
    ctx.fill();
    ctx.shadowBlur=0;

    // mira laser
    const angle=Math.atan2(Game.mouse.y-this.bullet.y,Game.mouse.x-this.bullet.x);
    ctx.strokeStyle="rgba(0,255,255,0.35)";
    ctx.beginPath();
    ctx.moveTo(this.bullet.x,this.bullet.y);
    ctx.lineTo(this.bullet.x+Math.cos(angle)*1000,this.bullet.y+Math.sin(angle)*1000);
    ctx.stroke();

    drawParticles();
  }
};

/* ===========================
   INPUT
=========================== */
canvas.addEventListener("mousemove",e=>{
  Game.mouse.x=e.clientX;
  Game.mouse.y=e.clientY;
});

canvas.addEventListener("mousedown",()=>{
  Game.charging=true;
});

canvas.addEventListener("mouseup",()=>{
  Game.charging=false;
  const angle=Math.atan2(Game.mouse.y-Game.bullet.y,Game.mouse.x-Game.bullet.x);
  Game.shoot(angle);
});

/* ===========================
   LOOP
=========================== */
function loop(){
  Game.update();
  Game.draw();
  updateUI();
  requestAnimationFrame(loop);
}

Game.init();
loop();
</script>
</body>
</html>