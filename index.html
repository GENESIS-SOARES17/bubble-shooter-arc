<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>USDC TERMINAL - REFORCED 2026</title>
    <style>
        :root { --primary: #00ff88; --secondary: #2775ca; --gold: #ffca28; }
        body { 
            margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; 
            background: #050505; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; 
        }
        
        /* Container com 80% de transpar√™ncia e desfoque */
        #game-container { 
            background: rgba(15, 15, 15, 0.8); 
            padding: 20px; border-radius: 28px; width: 850px; 
            border: 1px solid rgba(0, 255, 136, 0.3); backdrop-filter: blur(15px);
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }

        /* Ticker Top 10 Moedas */
        #ticker-top {
            background: rgba(0,0,0,0.7); padding: 12px; border-radius: 14px;
            margin-bottom: 20px; border: 1px solid #333; overflow: hidden;
        }
        .marquee-container { display: flex; overflow: hidden; white-space: nowrap; }
        .marquee-content { display: inline-block; animation: scroll 35s linear infinite; color: var(--primary); font-weight: bold; font-size: 14px; }
        @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* HUD e Calculadora */
        .hud-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .info-card { background: rgba(0,0,0,0.6); padding: 15px; border-radius: 18px; border: 1px solid #444; text-align: center; }

        /* Jogo 50% Maior */
        canvas { background: #000; border: 2px solid var(--secondary); border-radius: 20px; cursor: crosshair; display: block; margin: 0 auto; box-shadow: 0 0 20px rgba(39, 117, 202, 0.3); }

        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        button { border: none; padding: 16px; font-weight: bold; border-radius: 12px; cursor: pointer; text-transform: uppercase; font-size: 14px; transition: 0.3s; }
        
        #connect-btn { background: var(--primary); color: #000; grid-column: span 2; font-size: 18px; box-shadow: 0 0 15px rgba(0, 255, 136, 0.5); }
        #withdraw-btn { background: var(--gold); color: #000; }
        #reset-btn { background: var(--secondary); color: #fff; }

        .locked { opacity: 0.15; pointer-events: none; filter: blur(15px); }
        .coin-span { margin-right: 45px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ticker-top">
        <div class="marquee-container">
            <div class="marquee-content" id="price-marquee">SINCRONIZANDO RANKING GLOBAL...</div>
        </div>
    </div>

    <div class="hud-row">
        <div class="info-card">
            <span style="font-size: 11px; opacity: 0.6;">GANHOS ACUMULADOS</span>
            <div style="font-size: 26px; font-weight: bold; color: var(--primary);">$ <span id="usdc-val">0.000</span></div>
            <div id="brl-val" style="color: var(--gold); font-size: 13px; font-weight: bold;">R$ 0,00 (CALCULANDO...)</div>
        </div>
        <div class="info-card">
            <span style="font-size: 11px; opacity: 0.6;">ENERGIA DISPON√çVEL</span>
            <div id="energy-val" style="font-size: 26px; font-weight: bold;">-- / 3</div>
            <div id="timer-val" style="font-size: 11px; color: var(--gold);">REGEN: 3 HORAS</div>
        </div>
    </div>

    <div id="canvas-wrapper" class="locked">
        <canvas id="gameCanvas" width="800" height="450"></canvas>
    </div>

    <div class="btn-row">
        <button id="connect-btn">üîå CONECTAR CARTEIRA AGORA</button>
        <button id="withdraw-btn">üí∞ SACAR (TAXA 0.10)</button>
        <button id="reset-btn">üöÄ PR√ìXIMA FASE (-1‚ö°)</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let wallet = null;
    let balance = 0; 
    let energy = { count: 3, lastUsed: Date.now() };
    let brlPrice = 5.50;

    // --- 1. CHAMADA DA CARTEIRA (Prioridade M√°xima) ---
    document.getElementById('connect-btn').addEventListener('click', async () => {
        if (typeof window.ethereum !== 'undefined') {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                wallet = accounts[0];
                
                // Tenta recuperar progresso do localStorage
                const saved = JSON.parse(localStorage.getItem('usdc_terminal_' + wallet));
                if (saved) {
                    balance = saved.balance || 0;
                    energy = saved.energy;
                }

                // Libera a interface
                document.getElementById('connect-btn').style.display = 'none';
                document.getElementById('canvas-wrapper').classList.remove('locked');
                updateUI();
                startLoop();
            } catch (err) {
                alert("Conex√£o cancelada pelo usu√°rio.");
            }
        } else {
            alert("MetaMask n√£o encontrada. Por favor, instale a extens√£o.");
        }
    });

    // --- 2. COTA√á√ïES TOP 10 E CONVERSOR ---
    async function getMarketData() {
        try {
            // Pega Top 10 moedas
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&price_change_percentage=24h');
            const data = await res.json();
            
            const marquee = document.getElementById('price-marquee');
            marquee.innerHTML = data.map(coin => `
                <span class="coin-span">
                    ${coin.symbol.toUpperCase()}: $${coin.current_price.toLocaleString()} 
                    <span style="color: ${coin.price_change_percentage_24h >= 0 ? '#00ff88' : '#ff4444'}">
                        ${coin.price_change_percentage_24h >= 0 ? '‚ñ≤' : '‚ñº'} ${coin.price_change_percentage_24h.toFixed(2)}%
                    </span>
                </span>
            `).join('');

            // Cota√ß√£o Real
            const brlRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=usd-coin&vs_currencies=brl');
            const brlData = await brlRes.json();
            brlPrice = brlData['usd-coin'].brl;
            updateUI();
        } catch (e) { console.error("Falha ao buscar pre√ßos."); }
    }

    function updateUI() {
        document.getElementById('usdc-val').innerText = balance.toFixed(3);
        document.getElementById('brl-val').innerText = `R$ ${(balance * brlPrice).